---
title: "Public Health Intelligence  \nMonthly report – `r format(Sys.Date()-30, '%B %Y')`  \nWHE/WHR/ARC/PHI"
date: '`r format(Sys.Date(), "%d %B %Y")`'
subtitle: 'Work by WHO colleagues at HQ, ROs and WCOs'
output: 
  officedown::rpptx_document:
    reference_doc: "rmd_slide_template.pptx"
    slide_level: 2 # use this to override default
params:
  product_tracker: NULL
  eios: NULL
  don_tracker: NULL
  afro: FALSE
  amro: FALSE
  emro: FALSE
  euro: FALSE
  searo: FALSE
  wpro: FALSE
  global: FALSE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE,
                      error = FALSE,
                      message = FALSE,
                      dev = 'png',
                      dpi = 600)

#-----------------------------------------------------------------
pacman::p_load(officer, officedown,
               ggplot2, tidyverse,
               lubridate, rvg,
               flextable, zoo,
               stringi, readxl)


#-----------------------------------------------------------------
# Functions
simpleCap <- function(x) {
  s <- tolower(x)
  s <- strsplit(s, ' ')[[1]]
  str <- paste(toupper(substring(s, 1, 1)), substring(s, 2),
               sep = '', collapse = ' ')
  return(str)
}


#-----------------------------------------------------------------
# Report month
report.month <- format(Sys.Date() %m-% months(1), '%b %Y')

# SELECT WHO regions to print
# selected.region <- 'AFRO'
afro <- params$afro
amro <- params$amro
emro <- params$emro
euro <- params$euro
searo <- params$searo
wpro <- params$wpro
global <- params$global


# Region vector
all.selected.regions <- paste(
  c('AFRO', 'AMRO','EMRO','EURO','SEARO','WPRO','Global')[
    c(afro, amro, emro, euro, searo, wpro, global)
  ],
  collapse = ', ')


#-----------------------------------------------------------------
# DATA LOAD
#Load data EIOS articles screened
data_eios <- read_excel('EIOS_PHI_metrics_20230306.xlsx')


#------------------------------------------------------------------------------
#Load data Product tracker
data_pt <- read_excel('/Users/miguelmspereira/Downloads/Products tracker_v6.xlsx',
                      sheet = "product tracker")

# cbind(colnames(data_pt), col_types) %>%
#   as.data.frame(.) %>%
#   filter(col_types=='date') %>% pull(V1)

# Columns that need to be Date objects
pt.date.cols <- c("daily signal tracker", "Daily signal tracker update entry",
                  "EMS entry", "RRA_Decision_date",                
                  "RRA_start_date","RRA_pub_date",                     
                  "EIS_decision_date", "EIS_start_HQ_receive_date",        
                  "EIS sent to \r\nRegional office", "EIS sent to NFP", 
                  "Feedback NFP", "EIS_pub_date",                     
                  "DON_start_date", "DON_pub_date")

# Getting the column types to re-read the file properly
col.types <- tibble(cols = colnames(data_pt),
                    types = unlist(lapply(sapply(data_pt, class), 
                                          FUN=function(a) a[1]))) %>% 
  mutate(ctypes = case_when(
    types == 'character' ~ 'text',
    types == 'logical' ~ 'numeric',
    types == 'POSIXct' ~ 'date',
    types == 'POSIXt' ~ 'date',
    types == 'numeric' ~ 'numeric',
    .default = 'text'
  ),
  ctypes = ifelse(cols %in% pt.date.cols, 'date', ctypes))



data_pt <- read_excel('/Users/miguelmspereira/Downloads/Products tracker_v6.xlsx', 
                      sheet = "product tracker",
                      col_types = col.types$ctypes)



# col_types = c("text",
#                                                                "text", "text",
#                                                                "text", "text",
#                                                                "text",
#                                                                "date", "date",
#                                                                "date", "text",
#                                                                "text",
#                                                                "text", "text",
#                                                                "numeric", "text",
#                                                                "text", "text", "date", "date", "date",
#                                                                "text", "text", "text", "text", "text",
#                                                                "text", "text", "date", "date", "date",
#                                                                "date", "date", "date", "text", "date",
#                                                                "date", "text", "numeric", "numeric",
#                                                                "numeric", "numeric", "numeric",
#                                                                "numeric", "numeric", "numeric",
#                                                                "numeric", "numeric", "numeric",
#                                                                "numeric", "text")


#------------------------------------------------------------------------------
#Load data DON pipelinetracker
data_don <- read_excel('DON_Pipeline_Tracker_20230306.xlsx')

# Columns that need to be Date objects
don.date.cols <- c('Date EIS published', 
                   'Date EIS published (Text)', 
                   'Date of first DON draft', 
                   'Date DON Published')

# Getting the column types to re-read the file properly
col.types <- tibble(cols = colnames(data_don),
                    types = unlist(lapply(sapply(data_don, class), 
                                          FUN=function(a) a[1]))) %>% 
  mutate(ctypes = case_when(
    types == 'character' ~ 'text',
    types == 'logical' ~ 'numeric',
    types == 'POSIXct' ~ 'date',
    types == 'POSIXt' ~ 'date',
    types == 'numeric' ~ 'numeric',
    .default = 'text'
  ),
  ctypes = ifelse(cols %in% don.date.cols, 'date', ctypes))


data_don <- read_excel('DON_Pipeline_Tracker_20230306.xlsx',
                       col_types = col.types$ctypes)


# col_types = c("text", "numeric", "text", 
#               "text", "text", "text", "text", "text", 
#               "text", "text", "text", "text", "text", 
#               "text", "text", "date", "date", "text", 
#               "text", "date", "text", "text", "text", 
#               "text", "text", "numeric", "text", 
#               "text", "text", "text", "text", "date", 
#               "text", "numeric", "text", "text", 
#               "text", "text", "numeric", "numeric", 
#               "text", "text", "text", "text", "text", 
#               "numeric", "numeric", "numeric", 
#               "numeric", "numeric", "numeric", 
#               "numeric", "numeric", "numeric")




```

```{r include=FALSE}
# Product Tracker
# Create data frame for EMS data and select certain columns only from the dataframe for analyses
df_pt <- as.data.frame(data_pt) %>% 
  select("Status", "Product",                          
         "disease_condition", "country",                          
         "Countries (if multiple) or Region", "EMS event ID",                   
         "Need_RRA", "RRA_Decision_date",                
         "RRA_start_date", "RRA_pub_date",                     
         "RRA National risk level", "RRA Regional risk level",          
         "RRA Global risk level", "Need_EIS",                         
         "EIS_first_draft_by", "EIS_decision_date",                
         "EIS_start_HQ_receive_date", "EIS sent to \r\nRegional office",  
         "EIS sent to NFP", "Feedback NFP",                     
         "EIS_pub_date", "Need_DON",                         
         "DON_pub_date")

#rename column names
colnames(df_pt) <- c("status", 
                     "product", 
                     "disease",
                     "country",
                     "country_region", 
                     "EMS_ID",
                     "RRA", 
                     "RRA_date_decision",
                     "RRA_date_start",
                     "RRA_date_publication", 
                     "RRA_risk_nat", 
                     "RRA_risk_reg", 
                     "RRA_risk_glob",
                     "EIS",
                     "EIS_first_draft_by",
                     "EIS_date_decision",
                     "EIS_date_HQ",
                     "EIS_date_regional_office",
                     "EIS_sent_NFP",
                     "EIA_feedback_NFP",
                     "EIS_date_publication", 
                     "DON",
                     "DON_date_publication")


# DON
#create data frame for EMS data 
df_don <- as.data.frame(data_don) %>% 
  filter(!is.na(`Row last updated`)) %>% 
  select("Pipeline status", "Event ID",                       
         "Event", "Country",                        
         "Countries (If multiple)", "Country code",                   
         "Regional office", "Date EIS published",             
         "Date of first DON draft", "Date DON Published",            
         "Time between EIS and DON (days)")

#rename column names
colnames(df_don) <- c("status", 
                      "ID", 
                      "disease",
                      "country",
                      "country_additional", 
                      "country_code",
                      "region", 
                      "EIS_date_publication", 
                      "DON_date_first_draft", 
                      "DON_date_publication", 
                      "Time_EIS_DON_published" 
)


# EIOS - Dates cleaning
#create data frame for EMS data 
df_eios_plot <- as.data.frame(data_eios) %>% 
  select(Month, Read_total) %>% 
  arrange(Month) %>% 
  rename(Date_screened = Month,
         Read = Read_total) %>% 
  mutate(Date_screened = as.Date(Date_screened, format = "%m/%d/%y"))

```

```{r include=FALSE}
# RRA - data cleaning - dates
# replace NA values
df_pt$RRA_date_decision <- format(as.Date(df_pt$RRA_date_decision), "%Y-%m-%d")
df_pt$RRA_date_decision[is.na(df_pt$RRA_date_decision)] <- "1990-01-01"
df_pt$RRA_date_decision[df_pt$RRA_date_decision=="Not applicable"] <- "1990-01-01"
df_pt$RRA_date_decision[df_pt$RRA_date_decision=="Pending"] <- "1990-01-01"


df_pt$RRA_date_publication <- format(as.Date(df_pt$RRA_date_publication), "%Y-%m-%d")
df_pt$RRA_date_publication[is.na(df_pt$RRA_date_publication)] <- "1990-01-01"
df_pt$RRA_date_publication[df_pt$RRA_date_publication=="Not applicable"] <- "1990-01-01"


df_pt$RRA_date_start <- format(as.Date(df_pt$RRA_date_start), "%Y-%m-%d")
df_pt$RRA_date_start[is.na(df_pt$RRA_date_start)] <- "1990-01-01"
df_pt$RRA_date_start[df_pt$RRA_date_start=="Not applicable"] <- "1990-01-01"

#create date variables for dates
df_pt$RRA_date_decision <- as.Date(df_pt$RRA_date_decision)
df_pt$RRA_date_publication <- as.Date(df_pt$RRA_date_publication)
df_pt$RRA_date_start <- as.Date(df_pt$RRA_date_start)

#create year-month variable
df_pt$RRA_pub_year_month <- format(df_pt$RRA_date_publication, "%m/%y")
df_pt$RRA_pub_year_month <- as.Date(paste0("01/",df_pt$RRA_pub_year_month), format="%d/%m/%y")


# RRA data cleaning - variables
df_pt$RRA[df_pt$RRA=="yes"] <- "Yes"


# EIS - data cleaning - dates
# replace NA values in dates
df_pt$EIS_date_decision <- format(as.Date(df_pt$EIS_date_decision), "%Y-%m-%d")
df_pt$EIS_date_decision[is.na(df_pt$EIS_date_decision)] <- "1990-01-01"
df_pt$EIS_date_decision[df_pt$EIS_date_decision=="Not applicable"] <- "1990-01-01"

df_pt$EIS_date_HQ <- format(as.Date(df_pt$EIS_date_HQ), "%Y-%m-%d")
df_pt$EIS_date_HQ[is.na(df_pt$EIS_date_HQ)] <- "1990-01-01"
df_pt$EIS_date_HQ[df_pt$EIS_date_HQ=="Not applicable"] <- "1990-01-01"

df_pt$EIS_date_regional_office <- format(as.Date(df_pt$EIS_date_regional_office), "%Y-%m-%d")
df_pt$EIS_date_regional_office[is.na(df_pt$EIS_date_regional_office)] <- "1990-01-01"
df_pt$EIS_date_regional_office[df_pt$EIS_date_regional_office=="Not applicable"] <- "1990-01-01"

df_pt$EIS_date_publication <- format(as.Date(df_pt$EIS_date_publication), "%Y-%m-%d")
df_pt$EIS_date_publication[is.na(df_pt$EIS_date_publication)] <- "1990-01-01"
df_pt$EIS_date_publication[df_pt$EIS_date_publication=="Not applicable"] <- "1990-01-01"


#create date variables for dates
df_pt$EIS_date_decision <- as.Date(df_pt$EIS_date_decision)
df_pt$EIS_date_HQ <- as.Date(df_pt$EIS_date_HQ)
df_pt$EIS_date_regional_office <- as.Date(df_pt$EIS_date_regional_office)
df_pt$EIS_date_publication <- as.Date(df_pt$EIS_date_publication)

#create year-month variable
df_pt$EIS_pub_year_month <- format(df_pt$EIS_date_publication, "%m/%y")
df_pt$EIS_pub_year_month <- as.Date(paste0("01/",df_pt$EIS_pub_year_month), format="%d/%m/%y")

# EIS data cleaning - variables
df_pt$EIS[df_pt$EIS=="yes"] <- "Yes"
df_pt$EIS[df_pt$EIS=="no"] <- "No"

# DON data cleaning
# df_don %>% filter(is.na(df_don$DON_date_publication))
df_don$DON_date_publication <- format(as.Date(df_don$DON_date_publication), "%d-%b %Y")
df_don$DON_date_publication[is.na(df_don$DON_date_publication)] <- "01-Jan-1990"
df_don$DON_date_publication <- as.Date(df_don$DON_date_publication, format="%d-%b %Y")

df_don$EIS_date_publication <- format(as.Date(df_don$EIS_date_publication), "%d-%b %Y")
df_don$EIS_date_publication[is.na(df_don$EIS_date_publication)] <- "01-Jan-1990"
df_don$EIS_date_publication <- as.Date(df_don$EIS_date_publication, format="%d-%b %Y")


df_don$DON_date_first_draft <- format(as.Date(df_don$DON_date_first_draft), "%d-%b %Y")
df_don$DON_date_first_draft[is.na(df_don$DON_date_first_draft)] <- "01-Jan-1990"
df_don$DON_date_first_draft <- as.Date(df_don$DON_date_first_draft, format="%d-%b %Y")


# Modify EIS date publication
df_don <- df_don %>%
  mutate(EIS_date_publication =
           as.Date(ifelse(EIS_date_publication=='1990-01-01',
                          DON_date_first_draft,
                          EIS_date_publication)))


# Create year-month variable
df_don$DON_pub_year_month <- format(as.Date(df_don$DON_date_publication, format="%d-%b %Y"), "%m/%y")
df_don$DON_pub_year_month <- as.Date(paste0("01/",df_don$DON_pub_year_month), format="%d/%m/%y")

```

## Preamble

**Aim**

This presentation gives an overview of public health intelligence (PHI) in the Health Emergencies programme with a focus on activities globally that took place in `r format(as.Date(as.yearmon(report.month)), '%b %Y')` and with a deep dive on PHI activities in the following WHO region/s: `r all.selected.regions`

\ 

**Acknowledgments**

This presentation would not be possible without the work of WHO colleagues across the three levels of the Organization. We would like to thank, in particular, PHI and DVA unit/team members at HQ and ROs as well as colleagues in COs involved in signal verification and information product development.

\ 

**Questions/contact:**

If any further questions, please contact Dr. Esther Hamblion, Unit Head, [hamblione\@who.int](hamblione@who.int)

## **Public health intelligence activities: Overview**

![](slide2.png)

## **Outline**

**A. Global overview**

1.  Detection
2.  Information products

<br>

**B. Regional Deep dive -- WHO `r all.selected.regions`**

1.  [INSERT TEXT]
2.  [INSERT TEXT]

<br>

**C. Conclusion/summary**

## **Part A - Global overview**

## **Data sources and methods for global overview section**

**Data sources:**

-   Data extract from EIOS for pieces of information screened/read

-   Product tracker and DON pipeline tracker, two PHI databases used to document and track information products

\ 

**Data cleaning and analysis:**

-   Data was extracted on `r format(Sys.Date(), '%d %b %Y')` from the data sources

-   Data cleaning and analysis was done in R using R Studio

-   Data was presented as Tables or Figures

\ 

**Commonly used abbreviations:**

-   PHI: Public health intelligence

-   RRA: Rapid risk assessment

-   EIS: Event information site

-   DON: Disease outbreak news

\ 

**Note:** There might be differences in month to month reporting due to ongoing updates and database data cleaning.

## **Detection**

```{r layout='Title Only'}

```

## **EIOS: Pieces of information screened**

::: columns
::: column
```{r}
# Create figures information products published over time
fig_EIOS <- df_eios_plot %>% 
  filter(Date_screened > as.Date(as.yearmon(report.month)) %m-% months(7) & 
           Date_screened < as.Date(as.yearmon(report.month)) %m+% months(1)) %>% 
  ggplot(aes(x = Date_screened, y = Read)) +
  geom_bar(stat='identity', colour="black", fill="#56B4E9")+
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y")+
  expand_limits(y=c(0,70000))+
  scale_y_continuous(breaks=seq(0, 70000, 10000))+  # Ticks from 0-60, every 5
  theme(axis.ticks=element_blank())+
  labs(x="Date", y="Pieces of information read/screened (N)")+
  theme_bw()

fig_EIOS

```
:::

::: column
```{r include=FALSE}
# Average read in last 3 months
sum.stats <- summary(
  df_eios_plot$Read[(nrow(df_eios_plot)-2):nrow(df_eios_plot)]
)
```

### Key points:



**Increase/Decrease** in pieces of information screened/read since **XXX**, **increase/decrease** since **XXX**.



Average \# of pieces of information screened/read in last 3 months (`r paste0( format(as.Date(as.yearmon(report.month)) %m-% months(2), '%b %Y'),'-',format(as.Date(as.yearmon(report.month)), '%b %Y'))`: `r format(sum.stats['Mean'], big.mark   = ",")`)/month


:::
:::

## **Information products**

## **Information products: overview published products (1)**

```{r}
# Merge dataframe of information products
df_rra_count <- df_pt %>% 
  filter(RRA=="Yes") %>% 
  filter(RRA_pub_year_month > 
           as.Date(as.yearmon(report.month)) %m-% months(7)) %>% 
  group_by(RRA_pub_year_month) %>% 
  summarise(sum.rra=n())

df_eis_count <- df_pt %>% 
  filter(EIS=="Yes") %>%
  filter(EIS_pub_year_month > 
           as.Date(as.yearmon(report.month)) %m-% months(7)) %>% 
  group_by (EIS_pub_year_month) %>% 
  summarise(sum.eis=n())

df_don_count <- df_don %>% 
  filter(status=="Published") %>% 
  filter(DON_pub_year_month > 
           as.Date(as.yearmon(report.month)) %m-% months(7)) %>% 
  filter(!is.na(DON_pub_year_month)) %>% 
  group_by (DON_pub_year_month) %>% 
  summarise(sum.don=n())
 
# Rename colnames
colnames(df_rra_count)[1] <- "pub_year_month"
colnames(df_eis_count)[1] <- "pub_year_month"
colnames(df_don_count)[1] <- "pub_year_month"

# Create new dataframe
df_prod_count <- df_eis_count %>% 
  full_join(df_rra_count, by="pub_year_month") %>% 
  full_join(df_don_count, by="pub_year_month") 

df_prod_count[is.na(df_prod_count)] <- 0

df_prod_count <- df_prod_count %>% 
  mutate(total=sum.eis+sum.rra+sum.don)


# OUTPUT TABLE
current.month <- df_prod_count %>%
  mutate(pub_year_month = format(pub_year_month, format='%b %Y')) %>%
  filter(pub_year_month == report.month) %>%
  relocate(sum.rra, .after=pub_year_month)

previous.months <- df_prod_count %>% 
  filter(pub_year_month < as.Date(as.yearmon(report.month))) %>%
  mutate(pub_year_month = format(pub_year_month, format='%b %Y'),
         min=min(total), 
         max=max(total)) %>%
  summarise(
    pub_year_month = paste0('Previous 6 months \n(Min-Max)'),
    sum.rra = paste0('(',min(sum.rra),'-',max(sum.rra),')'),
    sum.eis = paste0('(',min(sum.eis),'-',max(sum.eis),')'),
    sum.don = paste0('(',min(sum.don),'-',max(sum.don),')'),
    total = paste0('(',min(total),'-',max(total),')')
  )

```

::: columns
::: column
```{r}
# Rendering Flextable
rbind(current.month,
      previous.months) %>%
  flextable() %>%
  set_header_labels(values = list(
    pub_year_month = '',
    sum.rra = 'RRA',
    sum.eis = 'EIS',
    sum.don = 'DON',
    total = 'Total'
  )) %>%
  align(j = 2:5, align='center', part='all') %>%
  bold(bold = TRUE, part = 'header') %>%
  bold(j = 1, bold = TRUE, part = 'body') %>%
  width(j=1, width=1.6)
```
:::

::: column
The PHI Unit at HQ, PHI/DVA teams in ROs in collaboration with COs have produced `r current.month$total` information products: `r current.month$sum.rra` RRAs, `r current.month$sum.eis` EIS and `r current.month$sum.don` DON reports in `r format(Sys.Date() %m-% months(1), '%b %Y')`.

\ 

- The overall number of information products in `r format(as.yearmon(report.month), '%B')` are in the **XX** of the range (min to max) of the past six months.

\ 

-   The number of RRAs were in the **XX** range, the number of EIS were in the **XX** range and the number of DON were in the **XX** range, compared to the previous six months
:::
:::


## **Information products: overview published products (2)**

-   Details of **RRA, EIS and DONs published in `r report.month`**:

```{r}
df_prod_dy_count_country_eis <- df_pt %>% 
  filter(EIS=="Yes") %>%
  filter(EIS_pub_year_month >= 
           as.Date(as.yearmon(report.month)) &
           EIS_pub_year_month < 
           as.Date(as.yearmon(report.month)) %m+% months(1)) %>%
  group_by (EIS_pub_year_month, disease, country) %>%
  summarise(sum.eis=n()) %>%
  mutate(disease = disease,
         country = stringi::stri_trans_totitle(country))


df_prod_dy_count_country_rra <- df_pt %>% 
  filter(RRA=="Yes") %>%
  filter(RRA_pub_year_month >= 
           as.Date(as.yearmon(report.month)) &
           RRA_pub_year_month < 
           as.Date(as.yearmon(report.month)) %m+% months(1)) %>%
  group_by (RRA_pub_year_month, disease, country) %>%
  summarise(sum.rra=n()) %>%
  mutate(disease = disease,
         country = stringi::stri_trans_totitle(country))


df_prod_dy_count_country_don <- df_don %>% 
  filter(status=="Published") %>%
  filter(DON_pub_year_month >= 
           as.Date(as.yearmon(report.month)) &
           DON_pub_year_month < 
           as.Date(as.yearmon(report.month)) %m+% months(1)) %>%
  group_by (DON_pub_year_month, disease, country) %>%
  summarise(sum.don=n()) %>%
  mutate(disease = disease,
         country = stringi::stri_trans_totitle(country))


# Rename values in disease column
df_prod_dy_count_country_rra$disease[str_sub(df_prod_dy_count_country_rra$disease, 1,5)=="Crime"] <- "Crimean-Congo hemorrhagic fever"
df_prod_dy_count_country_rra$disease[str_sub(df_prod_dy_count_country_rra$disease, 1,5)=="Monke"] <- "mpox"
df_prod_dy_count_country_rra$disease[str_sub(df_prod_dy_count_country_rra$disease, 1,5)=="Lassa"] <- "Lassa fever"
df_prod_dy_count_country_rra$disease[str_sub(df_prod_dy_count_country_rra$disease, 1,5)=="Yello"] <- "Yellow fever"
df_prod_dy_count_country_rra$disease[df_prod_dy_count_country_rra$disease=="Hepatitis (unspecified)"] <- "Acute hepatitis of unknown aetiology"

df_prod_dy_count_country_eis$disease[str_sub(df_prod_dy_count_country_eis$disease, 1,5)=="Crime"] <- "Crimean-Congo hemorrhagic fever"
df_prod_dy_count_country_eis$disease[str_sub(df_prod_dy_count_country_eis$disease, 1,5)=="Monke"] <- "mpox"
df_prod_dy_count_country_eis$disease[df_prod_dy_count_country_eis$disease=="Acute febrile jaundice syndrome"] <- "Acute hepatitis of unknown aetiology"
df_prod_dy_count_country_eis$disease[df_prod_dy_count_country_eis$disease=="Hepatitis (unspecified)"] <- "Acute hepatitis of unknown aetiology"

df_prod_dy_count_country_don$disease[str_sub(df_prod_dy_count_country_don$disease, 1,5)=="Dengu"] <- "Dengue"
#df_prod_dy_count_country_don$disease[str_sub(df_prod_dy_count_country_don$disease, 1,5)=="Influ"] <- "Avian influenza"
#df_prod_dy_count_country_don$disease[str_sub(df_prod_dy_count_country_don$disease, 1,5)=="Infue"] <- "Avian influenza"
df_prod_dy_count_country_don$disease[str_sub(df_prod_dy_count_country_don$disease, 1,5)=="Monke"] <- "mpox"
df_prod_dy_count_country_don$disease[str_sub(df_prod_dy_count_country_don$disease, 1,5)=="Lassa"] <- "Lassa fever"
df_prod_dy_count_country_don$disease[str_sub(df_prod_dy_count_country_don$disease, 1,5)=="Marbu"] <- "Marburg"
df_prod_dy_count_country_don$disease[df_prod_dy_count_country_don$disease=="Acute hepatitis of unknown aetiology in children - Multi-country"] <- "Acute hepatitis of unknown aetiology"
df_prod_dy_count_country_don$disease[df_prod_dy_count_country_don$disease=="Sudan Virus disease"] <- "Sudan virus disease"
df_prod_dy_count_country_don$disease[df_prod_dy_count_country_don$disease=="Invasive Group A Streptococcus infection"] <- "Scarlet fever and invasive Group A Streptococcus infection"
df_prod_dy_count_country_don$disease[df_prod_dy_count_country_don$disease=="Nipah virus disease"] <- "Nipah"
df_prod_dy_count_country_don$disease[df_prod_dy_count_country_don$disease=="Enterovirus Infection (E-11)"] <- "Enterovirus"
df_prod_dy_count_country_don$disease[df_prod_dy_count_country_don$disease=="Myocarditis"] <- "Neonatal myocarditis"

# Final table
info.products.table <- merge(merge(df_prod_dy_count_country_rra, 
                                   df_prod_dy_count_country_eis,
                                   by=c('disease', 'country'), all = TRUE),
                             df_prod_dy_count_country_don,
                             by=c('disease', 'country'), all = TRUE) %>%
  select(-RRA_pub_year_month, -EIS_pub_year_month, -DON_pub_year_month) %>%
  mutate(sum.rra=ifelse(is.na(sum.rra), 0, sum.rra),
         sum.eis=ifelse(is.na(sum.eis), 0, sum.eis),
         sum.don=ifelse(is.na(sum.don), 0, sum.don)) %>%
  mutate(total = sum.rra + sum.eis + sum.don) 


# Rendering Flextable
if(nrow(info.products.table) >0 ){
  rbind(info.products.table,
      c('', 'Total', sum(info.products.table$sum.rra), 
        sum(info.products.table$sum.eis), 
        sum(info.products.table$sum.don),
        sum(info.products.table$total))) %>%
  as.data.frame(.) %>% 
  flextable() %>%
  set_header_labels(values = list(
    disease = 'Disease/Condition',
    country = 'Country',
    sum.rra = 'RRA',
    sum.eis = 'EIS',
    sum.don = 'DON',
    total = 'Total'
  )) %>%
  align(j = 3:6, align='center', part='all') %>%
  bold(bold = TRUE, part = 'header') %>%
  hline(i=nrow(info.products.table), part='body') %>%
  bold(i = nrow(info.products.table)+1, bold = TRUE, part = 'body') %>%
  width(j=1, width=2)
}


```

## **Information products: overview published products (3)**

In **`r report.month`**, of the **`r current.month$total` RRA, EIS and DONs published:**

Information products were produced across `r nrow(info.products.table)` **(confirm number in previous slide)** events, in particular: **XXX**

- **X events** (Y% of all events), **related to disease A** with **C information products** (W% of all information products) 
- **X events** (Y% of all events), **related to disease B** with **D information products** (Y% of all information products) 


\ 

PHI published products (EIS, RRA, DON) on acute public health events related to **nearly all/all** WHO Regions:

-   Region with most important products:\
-   Other WHO regions:



## **Information products: overview published products (4)**

The PHI Unit is **also involved** in **several other information products** (non RRA, EIS, or DON), including **technical briefs and situation reports**, that are related to ongoing public health events.



The **main recurrent information products** currently are:



-   Weekly epidemiological update (WEU) on COVID-19: Summarises the latest evidence on variants of concern on a fortnightly basis and also has a different focus on a fortnightly basis. **XXX** WEU published in `r format(Sys.Date() %m-% months(1), '%b %Y')`.
-   Global Cholera situation report: First situation report published in March and second situation report developed in April (published in May).
-   mpox situation report (recurrent product from July 2022): Transition from EIS and DON to fortnightly situation report. First published 6 July, **XXX** sitreps published overall, of which **XXX** in `r format(Sys.Date() %m-% months(1), '%b %Y')`.
-   WHE Emergency Report in WER: Published monthly and includes summaries of DONs and sitreps published the previous month. **XXX** published, including **XXX** in the last month.



Data for these information products is not included in this slide deck (for now) but **substantially contributes** to the **workload -- especially as health emergencies/outbreaks become more protracted**.

## **Information products: Trends RRA, EIS, DON**

::: columns
::: column
```{r}
# Bar chart of products over time - by product
#create dataframe
df_fig_count <- df_prod_count %>% 
  filter(pub_year_month < as.Date(as.yearmon(report.month)) %m+% months(1)) %>% 
  gather(key="product", value="number", 2:5)

# Rename values and create factor variable
df_fig_count <- df_fig_count %>% 
  mutate(product = case_when(
    product == 'sum.eis' ~ 'EIS published',
    product == 'sum.rra' ~ 'RRA published',
    product == 'sum.don' ~ 'DON published',
    product == 'total' ~ 'All information products published'
  ),
  product = factor(product, levels = c("All information products published", 
                                       "RRA published", 
                                       "EIS published", 
                                       "DON published")))


# Create figures information products published over time
fig_infoprod <- ggplot(data=df_fig_count, aes(x = pub_year_month, y = number)) +
  geom_bar(stat='identity', colour="black", fill="#56B4E9") +
  geom_text(aes(label = number, vjust=-0.4)) +
  theme_bw() +
  theme(axis.ticks=element_blank(),
        axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position="none") +
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  expand_limits(y=c(0,40)) +
  labs(x="", y="Number") +
  facet_wrap(.~product, nrow = 2)

fig_infoprod
```
:::

::: column
**Overall\*:** (TO ADD)

\ 

**RRA:** (TO ADD)

\ 

**EIS:** (TO ADD)

\ 

**DON:** (TO ADD)

\ 

\**Only includes RRA, EIS and DON. Does not include other information products in which the PHI unit is involved or leads on.*
:::
:::

## **Information products: Disease/Condition Trends**

```{r fig.width=40, fig.height=25}
# Data by disease and month-year
df_rra_dy_count <- df_pt %>%   
  filter(RRA=="Yes") %>%   
  filter(RRA_pub_year_month > 
           as.Date(as.yearmon(report.month)) %m-% months(7)) %>%   
  group_by (RRA_pub_year_month, disease) %>%   
  summarise(sum.rra=n()) %>% 
  rename(pub_year_month = RRA_pub_year_month)


df_eis_dy_count <- df_pt %>%   
  filter(EIS=="Yes") %>%  
  filter(EIS_pub_year_month > 
           as.Date(as.yearmon(report.month)) %m-% months(7)) %>%
  group_by (EIS_pub_year_month, disease) %>%
  summarise(sum.eis=n()) %>% 
  rename(pub_year_month = EIS_pub_year_month)


df_don_dy_count <- df_don %>%   
  filter(status=="Published") %>%   
  filter(DON_pub_year_month > 
           as.Date(as.yearmon(report.month)) %m-% months(7)) %>%
  filter(!is.na(DON_pub_year_month)) %>%   
  group_by (DON_pub_year_month, disease) %>%   
  summarise(sum.don=n()) %>% 
  rename(pub_year_month = DON_pub_year_month)


#rename values in disease column
df_rra_dy_count$disease[str_sub(df_rra_dy_count$disease, 1,5)=="Avian"] <- "Avian influenza"
df_rra_dy_count$disease[str_sub(df_rra_dy_count$disease, 1,5)=="Shige"] <- "Shigellosis"
df_rra_dy_count$disease[str_sub(df_rra_dy_count$disease, 1,5)=="Crime"] <- "Crimean-Congo hemorrhagic fever"
df_rra_dy_count$disease[str_sub(df_rra_dy_count$disease, 1,5)=="Monke"] <- "mpox"
df_rra_dy_count$disease[str_sub(df_rra_dy_count$disease, 1,5)=="Lassa"] <- "Lassa fever"
df_rra_dy_count$disease[str_sub(df_rra_dy_count$disease, 1,5)=="Yello"] <- "Yellow fever"
df_rra_dy_count$disease[str_sub(df_rra_dy_count$disease, 1,5)=="Polio"] <- "Polio"
df_rra_dy_count$disease[str_sub(df_rra_dy_count$disease, 1,4)=="Wild"] <- "Polio"
df_rra_dy_count$disease[df_rra_dy_count$disease=="Hepatitis (unspecified)"] <- "Acute hepatitis of unknown aetiology"

df_eis_dy_count$disease[str_sub(df_eis_dy_count$disease, 1,5)=="Avian"] <- "Avian influenza"
df_eis_dy_count$disease[str_sub(df_eis_dy_count$disease, 1,5)=="Swine"] <- "Swine influenza variant"
df_eis_dy_count$disease[str_sub(df_eis_dy_count$disease, 1,5)=="Influ"] <- "Avian influenza"
df_eis_dy_count$disease[str_sub(df_eis_dy_count$disease, 1,5)=="Shige"] <- "Shigellosis"
df_eis_dy_count$disease[str_sub(df_eis_dy_count$disease, 1,5)=="Crime"] <- "Crimean-Congo hemorrhagic fever"
df_eis_dy_count$disease[str_sub(df_eis_dy_count$disease, 1,5)=="Polio"] <- "Polio"
df_eis_dy_count$disease[str_sub(df_eis_dy_count$disease, 1,4)=="Wild"] <- "Polio"
df_eis_dy_count$disease[str_sub(df_eis_dy_count$disease, 1,5)=="Monke"] <- "mpox"
df_eis_dy_count$disease[str_sub(df_eis_dy_count$disease, 1,5)=="Yello"] <- "Yellow fever"
df_eis_dy_count$disease[df_eis_dy_count$disease=="Acute febrile jaundice syndrome"] <- "Acute hepatitis of unknown aetiology"
df_eis_dy_count$disease[df_eis_dy_count$disease=="Hepatitis (unspecified)"] <- "Acute hepatitis of unknown aetiology"
df_eis_dy_count$disease[df_eis_dy_count$disease=="Hepatitis (unspecified)"] <- "Acute hepatitis of unknown aetiology"
df_eis_dy_count$disease[df_eis_dy_count$disease=="Hepatitis (unspecified)"] <- "Acute hepatitis of unknown aetiology"

df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Dengu"] <- "Dengue"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Influ"] <- "Avian influenza"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Infue"] <- "Avian influenza"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Avian"] <- "Avian influenza"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Monke"] <- "mpox"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Lassa"] <- "Lassa fever"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Circu"] <- "Polio"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,4)=="Wild"] <- "Polio"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Wild "] <- "Polio"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="cVDPV"] <- "Polio"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="WPV1"] <- "Polio"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Marbu"] <- "Marburg"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,3)=="XDR"] <- "Shigellosis"
df_don_dy_count$disease[str_sub(df_don_dy_count$disease, 1,5)=="Yello"] <- "Yellow fever"
df_don_dy_count$disease[df_don_dy_count$disease=="Acute hepatitis of unknown aetiology in children - Multi-country"] <- "Acute hepatitis of unknown aetiology"
df_don_dy_count$disease[df_don_dy_count$disease=="Sudan Virus disease"] <- "Sudan virus disease"
df_don_dy_count$disease[df_don_dy_count$disease=="Invasive Group A Streptococcus infection"] <- "Scarlet fever and invasive Group A Streptococcus infection"
df_don_dy_count$disease[df_don_dy_count$disease=="Nipah virus disease"] <- "Nipah"
df_don_dy_count$disease[df_don_dy_count$disease=="Enterovirus Infection (E-11)"] <- "Enterovirus"
df_don_dy_count$disease[df_don_dy_count$disease=="Myocarditis"] <- "Neonatal myocarditis"


#create overall dataframe
df_prod_dy_count <- df_eis_dy_count %>%   
  full_join(df_rra_dy_count, 
            by=c("pub_year_month", "disease")) %>%   
  full_join(df_don_dy_count, 
            by=c("pub_year_month", "disease")) 

df_prod_dy_count[is.na(df_prod_dy_count)] <- 0

df_prod_dy_count <- df_prod_dy_count %>% 
  mutate(total = sum.eis + sum.rra + sum.don)


# Heatmap of products over time - by product and disease
# Create dataframe
df_fig_dy_count <- df_prod_dy_count %>% 
  filter(pub_year_month < as.Date(as.yearmon(report.month)) %m+% months(1)) %>% 
  gather(key="product", value="Number", 3:6) %>% 
  mutate(product = case_when(
    product == 'sum.eis' ~ 'EIS',
    product == 'sum.rra' ~ 'RRA',
    product == 'sum.don' ~ 'DON',
    product == 'total' ~ 'All info products'
  ),
  product = factor(product, levels = c("All info products", 
                                       "RRA", 
                                       "EIS", 
                                       "DON")))


df_fig_dy_count$disease <- factor(df_fig_dy_count$disease,
                                  levels = rev(sort(unique(df_fig_dy_count$disease))))


# Heatmap
fig_heatmap_prod <- df_fig_dy_count %>% 
  ggplot(aes(pub_year_month, disease, fill=Number)) +
  geom_tile(color= "white",size=0.1) + 
  scale_x_date(date_breaks = "1 month", date_labels = "%b %Y") +
  labs(x="", y="") +
  facet_wrap(.~product, nrow = 1) +
  scale_fill_gradient(low = "white", high = "#0072B2", n.breaks=6) +
  theme_bw() +
  theme(axis.ticks=element_blank(),
        axis.text.x=element_text(angle=45, hjust=1.1, size=35),
        axis.text.y=element_text(size=40),
        panel.grid.major = element_blank(),
        strip.text = element_text(size=40),
        legend.key.size = unit(1.25, 'in'),
        legend.title = element_text(size=35),
        legend.text = element_text(size=35))

fig_heatmap_prod

```

## **Information products: Key trends (1)**

1.  **Continued high \# information products in `r report.month`, after EDIT higher/lower number during EDIT month/period:**

-   Increase in \# of information products produced in `r report.month` (n=XX), similar to MONTH (n=XX) & comparable to the **EDIT enter period**.

\ 

2.  **(EDIT - Largest number of events compared to previous three months)**

-   `r df_fig_count %>% filter(pub_year_month==as.Date(as.yearmon(report.month)), product=='All information products published') %>% pull(number)` information products produced for XX acute public health events in `r report.month`. This is the **EDIT largest/lowest/moderate** number of events for which PHI produced different information products, compared to **EDIT month/period**.
-   Various **EDIT specify disease events** events all had continued information products published in the **EDIT previous specify time** period.”
-   Underscores wide range of aetiologies/disease/conditions and countries affected which PHI operates on.

\ 

3.  **Two long-term reporting trends are here to stay and significantly increase workload**

-   

(1) Situation reports for protracted public health events, PHI members lead/contribute to varuous situation reports and COVID-19 WEU.

- 

(2) Global, regional or multi-country information products are now produced on a routine basis. In `r report.month`, **EDIT specify global or regional info products if done**.


## **Information products: Key trends (2)**

**Linkage of published EIS and (non) published DON reports:**

-   For most events, if there was an EIS posting, which will inform WHO Member States through their IHR NFP, there usually also is a DON, to inform the public if information about the event is already publicly available, according to criteria outlined in the IHR (2005).
-   `r nrow(info.products.table %>% mutate('EIS_(disease/condition, location)' = paste0(disease, ' - ', country),'DON_Outcome' = NA,'DON_Reason for not having a DON' = NA) %>% filter(sum.eis > 0))` EIS were posted in `r report.month` and for **EDIT** of these a decision was made not to publish a DON report. A full overview is provided in the Table below:

```{r ft.top=3.75}
# Rendering Flextable
info.products.table %>%
  mutate('EIS_(disease/condition, location)' = paste0(disease, ' - ', country),
         'DON_Outcome' = NA,
         'DON_Reason for not having a DON' = NA) %>%
  filter(sum.eis > 0) %>%
  select(-disease, -country, -sum.rra, -sum.eis, -sum.don, -total) %>%
  flextable() %>%
  separate_header() %>%
  align(j = 1:3, align='left', part='all') %>%
  align(j = 1, align='center', part='header') %>%
  align(i = 1, align='center', part='header') %>%
  # align(i = 2, j = 3, align='center', part='header') %>%
  bold(i = 1, bold = TRUE, part = 'header') %>%
  bold(i = 2, j = 2:3, bold = TRUE, part = 'header') %>%
  width(j = 1, width=3) %>%
  width(j = 2, width=2) %>%
  width(j = 3, width=6.5) %>%
  hline(i = 1, j = 2:3, part = 'header')

```


## **Rapid risk assessment: Timeliness (1)**

::: columns
::: column
```{r, results='asis'}
# RRA - timeliness
# Create dataframe and create variable time between decision and publication
df_rra_time <- df_pt %>% 
  filter(RRA=="Yes") %>% 
  mutate(time_rra = RRA_date_publication - RRA_date_decision,
         time_rra_decision_start = RRA_date_start - RRA_date_decision,
         time_rra_start_publication = RRA_date_publication - RRA_date_start)

date.levels <- df_rra_time %>%
  arrange(RRA_pub_year_month) %>%
  mutate(levels = format(RRA_pub_year_month, '%b %Y')) %>%
  pull(levels) %>% unique()

# Create Figure over time in the last 7 months since May 2022
Fig_RRA_time_box <- df_rra_time %>% 
  filter(RRA_pub_year_month!="1990-01-01") %>% 
  filter(RRA_pub_year_month > 
           as.Date(as.yearmon(report.month)) %m-% months(7) &
           RRA_pub_year_month < 
           as.Date(as.yearmon(report.month)) %m+% months(1)) %>% 
  arrange(RRA_pub_year_month) %>%
  ggplot(aes(x=factor(format(RRA_pub_year_month, '%b %Y'), levels=date.levels), y=as.numeric(time_rra))) +
  geom_boxplot(fill="#56B4E9") +
  labs(x="Date", y="Time (days)") +
  scale_y_continuous(breaks=seq(0, 110, 20)) +
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))

Fig_RRA_time_box


df_rra_time_by_month <- df_rra_time %>%
  filter(RRA_pub_year_month!="1990-01-01") %>% 
  filter(RRA_pub_year_month > 
           as.Date(as.yearmon(report.month)) %m-% months(7) &
           RRA_pub_year_month < 
           as.Date(as.yearmon(report.month)) %m+% months(1)) %>% 
  group_by(RRA_pub_year_month) %>%
  summarize(time_rra.median = 
              round(as.numeric(median(time_rra, na.rm=TRUE)), 0),
            time_rra.q25 = 
              round(as.numeric(quantile(time_rra, probs=c(0.25), na.rm=TRUE)), 0),
            time_rra.q75 = 
              round(as.numeric(quantile(time_rra, probs=c(0.75), na.rm=TRUE)), 0)) %>%
  mutate(RRA_pub_year_month2 = 
           as.character(format(as.Date(RRA_pub_year_month), '%b %Y')))



# Info for the median and IQR in the text
current.month <- df_rra_time_by_month %>% 
  filter(RRA_pub_year_month==as.Date(as.yearmon(report.month))) %>%
  select(time_rra.median, time_rra.q25, time_rra.q75)

previous.month <- df_rra_time_by_month %>% 
  filter(RRA_pub_year_month == 
           as.Date(as.yearmon(report.month)) %m-% months(1)) %>%
  select(time_rra.median, time_rra.q25, time_rra.q75)

```
:::

::: column
### Timeliness of RRA process:

-   Measured as time (days) between decision to do an RRA and RRA being published.

\ 

-   **(EDIT - Comparable/Similar/Higher)** number of RRAs published in `r format(Sys.Date() %m-% months(1), '%B')` vs `r format(Sys.Date() %m-% months(2), '%B')`: `r df_rra_count %>% filter(pub_year_month==as.Date(as.yearmon(report.month))) %>% pull(sum.rra)` and `r df_rra_count %>% filter(pub_year_month==as.Date(as.yearmon(report.month)) %m-% months(1)) %>% pull(sum.rra)` RRAs, respectively.

\ 

-   The median was **(EDIT - the same/higher/lower)** in `r format(Sys.Date() %m-% months(1), '%B')` (Median: `r current.month$time_rra.median` days, IQR: `r current.month$time_rra.q25`-`r current.month$time_rra.q75`) compared to `r format(Sys.Date() %m-% months(2), '%B')` (Median: `r previous.month$time_rra.median` days, IQR: `r previous.month$time_rra.q25`-`r previous.month$time_rra.q75` days).

\ 

-   Median time for an RRA **EDIT \< or \>** two weeks in `r format(Sys.Date() %m-% months(1), '%b %Y')`.

\ 

-   Note: **(IF APPLICABLE)**

\ 

*Figure -- Shows a boxplot of the time (Days) between the decision to do an RRA and the RRA being published by month of RRA published.*
:::
:::

## **Rapid risk assessment: Timeliness (2)**

![](rra_timeliness.png)

## **Rapid risk assessment: Timeliness (3)**

```{r}
rra.timeliness <- df_rra_time %>%
  mutate(time_rra_decision_start = 
           ifelse(RRA_date_start == '1990-01-01', NA, time_rra_decision_start),
         time_rra_start_publication = 
           ifelse(RRA_date_start =='1990-01-01', NA, time_rra_start_publication)) %>%
  filter(RRA_pub_year_month == as.Date(as.yearmon(report.month))) %>%
  mutate(country = ifelse(country=='Multiple', country_region, country)) %>%
  select(country, 
         disease, 
         RRA_date_decision, 
         RRA_date_publication, 
         time_rra, 
         time_rra_decision_start, 
         time_rra_start_publication)


percent.report.month <- round(nrow(rra.timeliness %>% filter(time_rra > 14))/
                                nrow(rra.timeliness)*100, 1)


timeliness.text <- paste0('(',percent.report.month,'%, ',
                          nrow(rra.timeliness %>% 
                                 filter(time_rra > 14)),
                          '/',
                          nrow(rra.timeliness), ')')


# Previous month
rra.timeliness.prev.month <- df_rra_time %>%
  filter(RRA_pub_year_month==as.Date(as.yearmon(report.month)) %m-% months(1))  %>%
  mutate(country = ifelse(country=='Multiple', country_region, country)) %>%
  select(country, disease, RRA_date_decision, RRA_date_publication, time_rra)


percent.report.month.prev.month <- 
  round(nrow(rra.timeliness.prev.month %>% filter(time_rra > 14)) /
          nrow(rra.timeliness.prev.month)*100, 1)


timeliness.text.prev.month <- paste0('(',percent.report.month.prev.month,'%, ',
                                     nrow(rra.timeliness.prev.month %>%
                                            filter(time_rra > 14)),
                                     '/',
                                     nrow(rra.timeliness.prev.month), ')')


rra.timeliness.prev.month.14 <- rra.timeliness.prev.month %>%
  filter(time_rra > 14)

timeliness.product.text.prev.month <-
  paste(
    paste0(rra.timeliness.prev.month.14$country, ', ',
           rra.timeliness.prev.month.14$disease, ', ',
           rra.timeliness.prev.month.14$time_rra,
           ' days'),
    collapse='; ')

```

\ 

- In **`r report.month`, `r nrow(rra.timeliness %>% filter(time_rra > 14))` RRAs** `r timeliness.text` had a **time** between decision and publication of **more than two weeks**, compared with **`r nrow(rra.timeliness.prev.month %>% filter(time_rra > 14))` RRAs** `r timeliness.text.prev.month` **in `r format(as.Date(as.yearmon(report.month)) %m-% months(1), '%b %Y')`** (`r timeliness.product.text.prev.month`).

\ 

\ 

-   **Details** of `r nrow(rra.timeliness %>% filter(time_rra > 14))` RRAs published in **`r report.month`** listed with **\>two weeks** between decision and publication:

```{r ft.top=4}
# Rendering Flextable
# List RRAs with decision time >14 days
rra.timeliness %>%
  filter(time_rra > 14) %>%
  arrange(desc(time_rra)) %>%
  flextable() %>%
  set_header_labels(values = list(
    country = 'Country',
    disease = 'Disease/\nCondition',
    RRA_date_decision = 'Date RRA decision',
    RRA_date_publication = 'Date RRA published',
    time_rra = 'Time decision-publication (days)',
    time_rra_decision_start = 'Time decision – start (days)',
    time_rra_start_publication = 'Time start – publication (days)'
  )) %>%
  align(j = 3:7, align='center', part='all') %>%
  bold(bold = TRUE, part = 'header') %>%
  # bold(j = 1, bold = TRUE, part = 'body') %>%
  width(j=1:7, width=1.6) %>%
  fontsize(size=14, part='all') %>%
  vline(j=5)

```



```{r, eval = FALSE}

## **Rapid risk assessment: Timeliness (4)**
rra.timeliness2 <- df_rra_time %>%
  filter(RRA_date_decision != '1990-01-01' & RRA_date_publication=='1990-01-01') %>%
  mutate(country = ifelse(country=='Multiple', country_region, country),
         time_rra_decision_now = Sys.Date() - RRA_date_decision) %>%
  filter(time_rra_decision_now >= 10) %>%
  select(country, disease, 
         RRA_date_decision, RRA_date_start,
         RRA_date_publication, time_rra, 
         time_rra_decision_start,time_rra_start_publication,
         time_rra_decision_now)


rra.timeliness2[rra.timeliness2=='1990-01-01'] <- NA

```




```{r ft.top=3, ft.left=1.5, eval= FALSE}
# -   **Details** of `r nrow(rra.timeliness2)` pending RRA **with 10 days or more days** from decision to `r format(Sys.Date(), '%d-%m-%Y')`:

# Rendering Flextable
rra.timeliness2 %>%
  select(country, disease, 
         RRA_date_decision, RRA_date_start, 
         time_rra_decision_now) %>%
  flextable() %>%
  set_header_labels(values = list(
    country = 'Country',
    disease = 'Disease/\nCondition',
    RRA_date_decision = 'Date RRA decision',
    RRA_date_start = 'Date RRA start',
    time_rra_decision_now = 'RRA Ongoing\n(days)'
  )) %>%
  align(j = 3:5, align='center', part='all') %>%
  bold(bold = TRUE, part = 'header') %>%
  width(j=1:5, width=2) %>%
  fontsize(size=14, part='all')

```




## **Event information site (EIS): Timeliness (1)**

::: columns
::: column
```{r}
# EIS - timeliness
# Create dataframe and create variable time between decision and publication
df_eis_time <- df_pt %>% 
  filter(EIS=="Yes") %>% 
  mutate(time_eis = EIS_date_publication - EIS_date_decision,
         time_eis_decision_start = EIS_date_HQ - EIS_date_decision,
         time_eis_start_regional = EIS_date_regional_office - EIS_date_HQ,
         time_eis_regional_publication = 
           EIS_date_publication - EIS_date_regional_office)


date.levels <- df_eis_time %>%
  arrange(EIS_pub_year_month) %>%
  mutate(levels = format(EIS_pub_year_month, '%b %Y')) %>%
  pull(levels) %>% 
  unique()


# Create Figure over time in the last 7 months since May 2022
Fig_EIS_time_box <- df_eis_time %>% 
  filter(EIS_pub_year_month > as.Date(as.yearmon(report.month)) %m-% months(7) & 
           EIS_pub_year_month < as.Date(as.yearmon(report.month)) %m+% months(1),
         EIS_date_decision != '1990-01-01',
         EIS_date_decision <= EIS_date_publication) %>% 
  ggplot(aes(x=factor(format(EIS_pub_year_month, '%b %Y'), levels=date.levels), y=as.numeric(time_eis))) +
  geom_boxplot(fill="#56B4E9")+
  labs(x="Date", y="Time (days)")+
  theme_bw()+
  theme(axis.text.x=element_text(angle=45, hjust=1))

Fig_EIS_time_box



df_eis_time_by_month <- df_eis_time %>%
  filter(EIS_pub_year_month!="1990-01-01") %>% 
  filter(EIS_pub_year_month > 
           as.Date(as.yearmon(report.month)) %m-% months(7) &
           EIS_pub_year_month < 
           as.Date(as.yearmon(report.month)) %m+% months(1)) %>% 
  group_by(EIS_pub_year_month) %>%
  summarize(time_eis.median = 
              round(as.numeric(median(time_eis, na.rm=TRUE)), 0),
            time_eis.q25 = 
              round(as.numeric(quantile(time_eis, probs=c(0.25)), na.rm=TRUE), 0),
            time_eis.q75 = 
              round(as.numeric(quantile(time_eis, probs=c(0.75)), na.rm=TRUE), 0)) %>%
  mutate(EIS_pub_year_month2 = 
           as.character(format(as.Date(EIS_pub_year_month), '%b %Y')))


# Info for the median and IQR in the text
current.month <- df_eis_time_by_month %>% 
  filter(EIS_pub_year_month==as.Date(as.yearmon(report.month))) %>%
  select(time_eis.median, 
         time_eis.q25, 
         time_eis.q75)

previous.month <- df_eis_time_by_month %>% 
  filter(EIS_pub_year_month == 
           as.Date(as.yearmon(report.month)) %m-% months(1)) %>%
  select(time_eis.median, 
         time_eis.q25, 
         time_eis.q75)

```
:::

::: column
### Timeliness of EIS posts process:

-   Measured as time (days) between decision to do an EIS and EIS being posted.

\ 

-   **(EDIT - Comparable/Similar/Higher)** number of EIS published in `r format(Sys.Date() %m-% months(1), '%B')` (n=`r df_eis_count %>% filter(pub_year_month==as.Date(as.yearmon(report.month))) %>% pull(sum.eis)`) compared `r format(Sys.Date() %m-% months(2), '%B')` (n=`r df_eis_count %>% filter(pub_year_month==as.Date(as.yearmon(report.month)) %m-% months(1)) %>% pull(sum.eis)`).

\ 

-   Since `r format(df_eis_time_by_month$EIS_pub_year_month[which.min(df_eis_time_by_month$EIS_pub_year_month)], '%b %Y')`, the median time for an EIS has been between `r min(df_eis_time_by_month$time_eis.median)` -- `r max(df_eis_time_by_month$time_eis.median)` days.

\ 

-   The median was **(EDIT - the same/higher/lower)** in `r format(Sys.Date() %m-% months(1), '%B')` (Median: `r current.month$time_eis.median` days, IQR: `r current.month$time_eis.q25`-`r current.month$time_eis.q75`) compared to `r format(Sys.Date() %m-% months(2), '%B')` (Median: `r previous.month$time_eis.median` days, IQR: `r previous.month$time_eis.q25`-`r previous.month$time_eis.q75` days).

\ 

-   Note: **(IF APPLICABLE)**

\ 

*Figure -- Shows a boxplot of the time (Days) between the decision to do an EIS and the EIS being posted by month of EIS posting.*
:::
:::

## **Event information site (EIS): Timeliness (2)**

![](eis_timeliness.png)

## **Event information site (EIS): Timeliness (3)**

```{r}
eis.timeliness <- df_eis_time %>%
  filter(EIS_pub_year_month == as.Date(as.yearmon(report.month))) %>%
  mutate(country = ifelse(country=='Multiple', country_region, country)) %>%
  select(country, 
         disease, 
         EIS_first_draft_by,
         EIS_date_decision, 
         EIS_date_HQ,
         EIS_date_regional_office,
         EIS_date_publication, 
         time_eis,
         time_eis_decision_start,
         time_eis_start_regional,
         time_eis_regional_publication)


percent.report.month <- round(nrow(eis.timeliness %>% filter(time_eis > 7))/
                                nrow(eis.timeliness)*100, 1)

timeliness.text <- paste0('(',percent.report.month,'%, ',
                          nrow(eis.timeliness %>% 
                                 filter(time_eis > 7)),
                          '/',
                          nrow(eis.timeliness), ')')


# Previous month
eis.timeliness.prev.month <- df_eis_time %>%
  filter(EIS_pub_year_month == 
           as.Date(as.yearmon(report.month)) %m-% months(1))  %>%
  mutate(country = ifelse(country=='Multiple', country_region, country)) %>%
  select(country, disease, EIS_date_decision, EIS_date_publication, time_eis)


percent.report.month.prev.month <- round(nrow(eis.timeliness.prev.month %>% 
                                                filter(time_eis > 7))/
                                           nrow(eis.timeliness.prev.month)*100, 1)

timeliness.text.prev.month <- paste0('(',percent.report.month.prev.month,'%, ',
                                     nrow(eis.timeliness.prev.month %>%
                                            filter(time_eis > 7)),
                                     '/',
                                     nrow(eis.timeliness.prev.month), ')')


eis.timeliness.prev.month.7 <- eis.timeliness.prev.month %>%
  filter(time_eis > 7)


timeliness.product.text.prev.month <-
  paste(
    paste0(eis.timeliness.prev.month.7$country, ', ',
           eis.timeliness.prev.month.7$disease, ', ',
           eis.timeliness.prev.month.7$time_eis,
           ' days'),
    collapse='; ')

```

\ 

- In **`r report.month`, `r nrow(eis.timeliness %>% filter(time_eis > 7))` EISs** `r timeliness.text` had a **time** between decision and publication of **more than 7 days**, compared with **`r nrow(eis.timeliness.prev.month %>% filter(time_eis > 7))` EISs** `r timeliness.text.prev.month` **in `r format(as.Date(as.yearmon(report.month)) %m-% months(1), '%b %Y')`** (`r timeliness.product.text.prev.month`).

\ 

\ 

-   **Details** of `r nrow(eis.timeliness %>% filter(time_eis > 7))` EIS published in **`r report.month`** listed with **> 7 days** between decision and publication:



```{r ft.top=4}
# List of EIS with decision time >14 days
eis.timeliness %>%
  mutate(time_eis_decision_start = 
           ifelse(EIS_date_HQ == '1990-01-01', NA, time_eis_decision_start),
         time_eis_start_regional = 
           ifelse(EIS_date_regional_office =='1990-01-01' | EIS_date_HQ =='1990-01-01', 
                  NA, 
                  time_eis_start_regional),
         time_eis_regional_publication = 
           ifelse(EIS_date_regional_office =='1990-01-01', 
                  NA, 
                  time_eis_regional_publication)) %>%
  select(country, 
         disease, 
         EIS_first_draft_by, 
         EIS_date_publication, 
         time_eis, 
         time_eis_decision_start, 
         time_eis_start_regional, time_eis_regional_publication) %>%
  filter(time_eis >14) %>%
  arrange(desc(time_eis)) %>%
  flextable() %>%
  set_header_labels(values = list(
    country = 'Country',
    disease = 'Disease/\nCondition',
    EIS_first_draft_by = 'Initiated by',
    EIS_date_publication = 'Date EIS publication',
    time_eis = 'Time decision-publication (days)',
    time_eis_decision_start = 'Time decision – start (days)', 
    time_eis_start_regional = 'Time start – shared with RO (days)', 
    time_eis_regional_publication = 'Time shared with RO - publication'
  )) %>%
  align(j = 3:5, align='center', part='all') %>%
  bold(bold = TRUE, part = 'header') %>%
  width(j=1:8, width=1.5) %>%
  fontsize(size=14, part='all') %>%
  vline(j=5)


```




```{r, eval=FALSE}
## **Event information site (EIS): Timeliness (4)**
eis.timeliness2 <- df_eis_time %>%
  filter(EIS_date_decision != '1990-01-01' & EIS_date_publication=='1990-01-01') %>%
  mutate(country = ifelse(country=='Multiple', country_region, country),
         time_eis_decision_now = Sys.Date() - EIS_date_decision) %>%
  filter(time_eis_decision_now >= 10) %>%
  select(country, disease, 
         EIS_first_draft_by, EIS_date_decision,
         EIS_date_HQ, EIS_date_regional_office, 
         EIS_sent_NFP, EIA_feedback_NFP, 
         time_eis_decision_now)

eis.timeliness2[eis.timeliness2=='1990-01-01'] <- NA

```


```{r ft.top=3, eval=FALSE}
# -   **Details** of `r nrow(eis.timeliness2)` EISs **with 10 days or more days** from decision to `r format(Sys.Date(), '%d-%m-%Y')`:
eis.timeliness2 %>%
  mutate(EIS_sent_NFP = as.Date(EIS_sent_NFP),
         EIA_feedback_NFP = as.Date(EIA_feedback_NFP)) %>% 
  flextable() %>%
  set_header_labels(values = list(
    country = 'Country',
    disease = 'Disease/\nCondition',
    EIS_first_draft_by = 'Initiated by',
    EIS_date_decision = 'Date EIS decision',
    EIS_date_HQ = 'Date EIS start/receive date', 
    EIS_date_regional_office = 'Date EIS share RO', 
    EIS_sent_NFP = 'Date EIS share NFP', 
    EIA_feedback_NFP = 'Date feedback NFP',
    time_eis_decision_now = 'EIS Ongoing\n(days)'
  )) %>%
  align(j = 2:9, align='center', part='all') %>%
  bold(bold = TRUE, part = 'header') %>%
  width(j=1:9, width=1.25) %>%
  fontsize(size=14, part='all')


```


## **Disease outbreak news (DON): Timeliness (1)**

::: columns
::: column
```{r include = FALSE}
# DON - timeliness
# Create time variable
df_don_time <- df_don %>% 
  filter(status=="Published") %>% 
  filter(DON_pub_year_month > as.Date(as.yearmon(report.month)) %m-% months(7) &
           DON_pub_year_month < as.Date(as.yearmon(report.month)) %m+% months(1)) %>% 
  mutate(time_don=DON_date_publication-EIS_date_publication)
```

```{r}
# Create Figure over time in the last 7 months since May 2022
date.levels <- df_don_time %>%
  arrange(DON_pub_year_month) %>%
  mutate(levels = format(DON_pub_year_month, '%b %Y')) %>%
  pull(levels) %>% 
  unique()


Fig_DON_time_box <- df_don_time %>% 
  filter(DON_pub_year_month > as.Date(as.yearmon(report.month)) %m-% months(7) & 
           DON_pub_year_month < as.Date(as.yearmon(report.month)) %m+% months(1)) %>% 
  ggplot(aes(x=factor(format(DON_pub_year_month, '%b %Y'), levels=date.levels),
             y=as.numeric(time_don))) +
  geom_boxplot(fill="#56B4E9") +
  labs(x="Date", y="Time (days)") +
  scale_y_continuous(breaks=seq(0, 45, 5)) +
  theme_bw() +
  theme(axis.text.x=element_text(angle=45, hjust=1))

Fig_DON_time_box



df_don_time_by_month <- df_don_time %>%
  filter(DON_pub_year_month!="1990-01-01") %>% 
  filter(DON_pub_year_month > as.Date(as.yearmon(report.month)) %m-% months(7) &
           DON_pub_year_month < as.Date(as.yearmon(report.month)) %m+% months(1)) %>% 
  group_by(DON_pub_year_month) %>%
  summarize(time_don.median = round(as.numeric(median(time_don, na.rm=TRUE)), 0),
            time_don.q25 = round(as.numeric(quantile(time_don, probs=c(0.25), na.rm=TRUE)), 0),
            time_don.q75 = round(as.numeric(quantile(time_don, probs=c(0.75), na.rm=TRUE)), 0)) %>%
  mutate(DON_pub_year_month2 = as.character(format(as.Date(DON_pub_year_month), '%b %Y')))


# Info for the median and IQR in the text
current.month <- df_don_time_by_month %>% 
  filter(DON_pub_year_month==as.Date(as.yearmon(report.month))) %>%
  select(time_don.median, 
         time_don.q25, 
         time_don.q75)


previous.month <- df_don_time_by_month %>% 
  filter(DON_pub_year_month==as.Date(as.yearmon(report.month)) %m-% months(1)) %>%
  select(time_don.median, 
         time_don.q25, 
         time_don.q75)


```
:::
::: column

### Timeliness of DON process:

-   Measured as time (days) between the EIS posting and the DON being published, as the DON drafting is initiated when an EIS is posted.

\ 

-   **(EDIT - Comparable/Similar/Higher)** number of DON published in `r format(Sys.Date() %m-% months(1), '%B')` (n=`r df_don_count %>% filter(pub_year_month==as.Date(as.yearmon(report.month))) %>% pull(sum.don)`) compared `r format(Sys.Date() %m-% months(2), '%B')` (n=`r df_don_count %>% filter(pub_year_month==as.Date(as.yearmon(report.month)) %m-% months(1)) %>% pull(sum.don)`).

\ 

-   Since `r format(df_don_time_by_month$DON_pub_year_month[which.min(df_don_time_by_month$DON_pub_year_month)], '%b %Y')`, the median time for a DON has been between `r min(df_don_time_by_month$time_don.median)` -- `r max(df_don_time_by_month$time_don.median)` days.

\ 

-   The median was **(EDIT - the same/higher/lower)** in `r format(Sys.Date() %m-% months(1), '%B')` (Median: `r current.month$time_don.median` days, IQR: `r current.month$time_don.q25`-`r current.month$time_don.q75`) compared to `r format(Sys.Date() %m-% months(2), '%B')` (Median: `r previous.month$time_don.median` days, IQR: `r previous.month$time_don.q25`-`r previous.month$time_don.q75` days).

\ 

-   Note: **(IF APPLICABLE)**

\ 

*Figure -- Shows a boxplot of the time (Days) between the EIS posting and the DON being published by month of DON published.*
:::
:::

## **Disease outbreak news (DON): Timeliness (2)**

```{r}
don.timeliness <- df_don_time %>%
  filter(DON_pub_year_month==as.Date(as.yearmon(report.month))) %>%
  filter(time_don > 7) %>%
  mutate(country = ifelse(country=='Multiple', country_region, country)) %>%
  select(country, disease, EIS_date_publication, DON_date_publication, time_don)

don.timeliness <- df_don_time %>%
  filter(DON_pub_year_month==as.Date(as.yearmon(report.month))) %>%
  mutate(country = ifelse(country=='Multiple', country_region, country)) %>%
  select(country, disease, EIS_date_publication, DON_date_publication, time_don)

percent.report.month <- round(nrow(don.timeliness %>% filter(time_don > 7))/
                                nrow(don.timeliness)*100, 1)


timeliness.text <- paste0('(',percent.report.month,'%, ',
                          nrow(don.timeliness %>% 
                                 filter(time_don > 7)),
                          '/',
                          nrow(don.timeliness),
                          ')')


# Previous month
don.timeliness.prev.month <- df_don_time %>%
  filter(DON_pub_year_month==as.Date(as.yearmon(report.month)) %m-% months(1))  %>%
  mutate(country = ifelse(country=='Multiple', country_region, country)) %>%
  select(country, disease, EIS_date_publication, DON_date_publication, time_don)


percent.report.month.prev.month <- 
  round(nrow(don.timeliness.prev.month %>% filter(time_don > 7))/
          nrow(don.timeliness.prev.month)*100, 1)


timeliness.text.prev.month <- paste0('(',percent.report.month.prev.month,'%, ',
                                     nrow(don.timeliness.prev.month %>%
                                            filter(time_don > 7)),
                                     '/',
                                     nrow(don.timeliness.prev.month), ')')


don.timeliness.prev.month.7 <- don.timeliness.prev.month %>%
  filter(time_don > 7)

timeliness.product.text.prev.month <-
  paste(
    paste0(don.timeliness.prev.month.7$country, ', ',
           don.timeliness.prev.month.7$disease, ', ',
           don.timeliness.prev.month.7$time_don,
           ' days'),
    collapse='; ')


```

\ 

- In **`r report.month`, `r nrow(don.timeliness %>% filter(time_don > 7))` DONs** `r timeliness.text` had a **time** between decision and publication of **more than 7 days**, compared with **`r nrow(don.timeliness.prev.month %>% filter(time_don > 7))` DONs** `r timeliness.text.prev.month` **in `r format(as.Date(as.yearmon(report.month)) %m-% months(1), '%b %Y')`** (`r timeliness.product.text.prev.month`).

\ 

\ 

-   **Details** of `r nrow(don.timeliness  %>% filter(time_don > 7))` DONs published in **`r report.month`** listed with **>7 days** between EIS posting and publication:


```{r ft.top=4.2}
# List DONs with decision time >7 days in May and Apr 2022
don.timeliness %>%
  filter(time_don > 7) %>%
  flextable() %>%
  set_header_labels(values = list(
    country = 'Country',
    disease = 'Disease/Condition',
    EIS_date_publication = 'Date EIS Posting',
    DON_date_publication = 'Date DON publication',
    time_don = 'Time (days)'
  )) %>%
  align(j = 1:2, align='left', part='all') %>%
  align(j = 3:5, align='center', part='all') %>%
  bold(bold = TRUE, part = 'header') %>%
  width(j=1:4, width=2) %>%
  fontsize(size=14)


```


```{r}
# Saving timeliness objects from overall to print in the 
rra.timeliness.all <- rra.timeliness
rra.timeliness.prev.month.all <- rra.timeliness.prev.month

eis.timeliness.all <- eis.timeliness
eis.timeliness.prev.month.all <- eis.timeliness.prev.month

don.timeliness.all <- don.timeliness
don.timeliness.prev.month.all <- don.timeliness.prev.month


# Dynamic text
rra.text.sign <- ifelse(median(rra.timeliness.all %>% pull(time_rra), na.rm=T) > 
                          median(rra.timeliness.prev.month.all %>%
                                   pull(time_rra), na.rm=T), 
                        '>', 
                        '<')
rra.text.sign <- ifelse(median(rra.timeliness.all %>% pull(time_rra), na.rm=T) == 
                          median(rra.timeliness.prev.month.all %>%
                                   pull(time_rra), na.rm=T), 
                        '=', 
                        rra.text.sign)

eis.text.sign <- ifelse(median(eis.timeliness.all %>% pull(time_eis), na.rm=T) > 
                          median(eis.timeliness.prev.month.all %>%
                                   pull(time_eis), na.rm=T), 
                        '>', 
                        '<')
eis.text.sign <- ifelse(median(eis.timeliness.all %>% pull(time_eis), na.rm=T) == 
                          median(eis.timeliness.prev.month.all %>%
                                   pull(time_eis), na.rm=T), 
                        '=', 
                        eis.text.sign)

don.text.sign <- ifelse(median(don.timeliness.all %>% pull(time_don), na.rm=T) > 
                          median(don.timeliness.prev.month.all %>%
                                   pull(time_don), na.rm=T), 
                        '>', 
                        '<')
don.text.sign <- ifelse(median(don.timeliness.all %>% pull(time_don), na.rm=T) == 
                          median(don.timeliness.prev.month.all %>%
                                   pull(time_don), na.rm=T), 
                        '=', 
                        don.text.sign)


```



```{r}
selected.region <- 'AFRO'
```

```{r child='country_report.Rmd', eval=afro}

```


```{r}
selected.region <- 'AMRO'
```

```{r child='country_report.Rmd', eval=amro}

```


```{r}
selected.region <- 'EMRO'
```

```{r child='country_report.Rmd', eval=emro}

```


```{r}
selected.region <- 'EURO'
```

```{r child='country_report.Rmd', eval=euro}

```


```{r}
selected.region <- 'SEARO'
```

```{r child='country_report.Rmd', eval=searo}

```


```{r}
selected.region <- 'WPRO'
```

```{r child='country_report.Rmd', eval=wpro}

```


```{r}
selected.region <- 'Global'
```

```{r child='country_report.Rmd', eval=global}

```


## **Conclusion/Summary**

## **Global - take home messages: trends**

1. **(EDIT Increase/Decrease)** in # of pieces of **information screened**/read in **`r report.month`** compared to previous month (`r format(as.Date(as.yearmon(report.month)) %m-% months(1), '%b %Y')`).

\ 

2. **(EDIT Higher/Lower) # of** acute public health **events (N=18)** requiring **more information products (N=27)** compared to the preceding month. 

* Various **(EDIT - Add selected disease examples)** events in **different WHO Regions** for **several months**
* **Overall, wide range** of **disease/conditions** requiring **information products**
* Also, **simultaneously, tracking** and/or **working** on **in progress information products** for **other** acute public health **events**. 

\ 

3. **Timeliness** of all information products **below the/exceeding thresholds in `r format(as.yearmon(report.month), '%b %Y')`**.

* **Median timeliness** of **RRAs >/< 14 days** - `r report.month` median (`r median(rra.timeliness.all %>% pull(time_rra), na.rm=T)` days) `r rra.text.sign` `r format(as.Date(as.yearmon(report.month)) %m-% months(1), '%b %Y')` median (`r median(rra.timeliness.prev.month.all %>% pull(time_rra), na.rm=T)` days).
* **Median timeliness** of **EIS >/< 14 days** - `r report.month` median (`r median(eis.timeliness.all %>% pull(time_eis), na.rm=T)` days) `r eis.text.sign` `r format(as.Date(as.yearmon(report.month)) %m-% months(1), '%b %Y')` median (`r median(eis.timeliness.prev.month.all %>% pull(time_eis), na.rm=T)` days ).
* **Median timeliness** of **DON reports >/< 7 days**  - `r report.month` median (`r median(don.timeliness.all %>% pull(time_don), na.rm=T)` days) `r don.text.sign` `r format(as.Date(as.yearmon(report.month)) %m-% months(1), '%b %Y')` median (`r median(don.timeliness.prev.month.all %>% pull(time_don), na.rm=T)` days).



## **Global - take home messages: Operational**

1. **High workload requires experienced and long-term staffing**
- High # of information products 
- Continued and increasing production and coordination of situation reports
- Continuous monitoring and tracking of new and ongoing health threats

\ 

2. **Timeliness** metrics **off target**, partly related to **extensive communications and delays with NFP**

- Higher # information products also influences timeliness as same staff simultaneously coordinating and working across increased # of products
- Review of procedures and enhanced tracking ongoing to guide more rapid senior level decision-making and action on publication of information products

\ 

3. **Not all work** of regional PHI/DVA teams **included** in this report. Rather **focus** on **outputs** related to **under IHR** (RRA, EIS, DON). 
- **Other work includes** Public health Situation Analyses (**PHSA**), **dashboards**, and **regional reports/situation reports**. 



```{r}
selected.region <- 'AFRO'
```

```{r child='country_conclusion.Rmd', eval=afro}

```


```{r}
selected.region <- 'AMRO'
```

```{r child='country_conclusion.Rmd', eval=amro}

```


```{r}
selected.region <- 'EMRO'
```

```{r child='country_conclusion.Rmd', eval=emro}

```


```{r}
selected.region <- 'EURO'
```

```{r child='country_conclusion.Rmd', eval=euro}

```


```{r}
selected.region <- 'SEARO'
```

```{r child='country_conclusion.Rmd', eval=searo}

```


```{r}
selected.region <- 'WPRO'
```

```{r child='country_conclusion.Rmd', eval=wpro}

```


